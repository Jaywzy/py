<!-- doc/src/sgml/lt-standby-forward.sgml -->
<sect1 id="lt-standby-forward" xreflabel="lt_standby_forward">
  <title>lt_standby_forward</title>

  <indexterm zone="lt-standby-forward">
    <primary>lt_standby_forward (EXPERIMENTAL)</primary>
  </indexterm>
  <para>
    <filename>lt_standby_forward</filename> is a module which forwards SQL statements from a hot standby to primary,
    providing a facility to reduce loading of primary, and to allow clients query from standby.
    For example, clients can send INSERT, CREATE to a hot standby.
  </para>

  <sect2>
    <title>Configuration Parameters</title>
    <variablelist>
      <varlistentry>
        <term>
          <varname>lt_standby_forward.enable_forward</varname>
          <indexterm>
            <primary><varname>lt_standby_forward.enable</varname>configuration parameter</primary>
          </indexterm>
        </term>
        <listitem>
          <para>
            It controls whether this feature is enabled or not user. Default is <literal>off</literal>. Set this option on standby, or for a single session.
          </para>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect2>

  <sect2>
    <title>Usage</title>
    <para>
      You must add the line shown below in your <literal>lightdb.conf</literal>.
<programlisting>
shared_preload_libraries = 'lt_standby_forward'
</programlisting>
    </para>
  </sect2>

  <sect2>
    <title>Authentication</title>
    <para>
    lt_standby_forward uses <literal>primary_conninfo</literal> to connect to primary,
    appending current dbname and username (i.e. the db and user used to connect to standby) to primary_conninfo.
    The connection info looks like
<programlisting>
primary_conninfo dbname=a_db user=a_user application_name=lt_standby_forward options='-c opt1=value1 -c opt2=value2'
</programlisting>
    It is not supported to set passward. Config <literal>lt_hba.conf</literal> on primary, or put password in <literal>passfile</literal> on standby to avoid typing password.
    </para>
  </sect2>

  <sect2>
    <title>Features/Limitations</title>
    <para>
      <itemizedlist>
        <listitem>
          <para>
            Forwards DELETE, UPDATE, INSERT, SELECT with modifying CTE to primary.
          </para>
        </listitem>
        <listitem>
          <para>
            Forwards SELECT/CALL statements containing volatile function to primary, otherwise executes on standby.
          </para>
        </listitem>
        <listitem>
          <para>
            Executes read only transactions on standby, otherwise forwards to primary.
          </para>
        </listitem>
        <listitem>
          <para>
            DDL is not allowed in transactions.
          </para>
        </listitem>
        <listitem>
          <para>
            View is rewriten (expanded) on standby before forwarding to primary. Query fails if view contains objects cannot be accessed by current user.
          </para>
        </listitem>
        <listitem>
          <para>
            Executes SET on both sides, execute show on standby.
            Don't SET xxx_timeout after connection established, set these parameters with ltsql/jdbc parameter <literal>options</literal>.
            For ltsql/jdbc <literal>options</literal>, only <literal>statement_timeout</literal>, <literal>lock_timeout</literal> and <literal>idle_in_transaction_session_timeout</literal> will be pass to primary.
          </para>
        </listitem>
        <listitem>
          <para>
            COPY FROM is not supported.
          </para>
        </listitem>
        <listitem>
          <para>
            CREATE TEMP/UNLOGGED TABLE is not supported.
          </para>
        </listitem>
        <listitem>
          <para>
            Utility commands not mentioned above are forwarded to primary.
          </para>
        </listitem>
        
      </itemizedlist>
    </para>
  </sect2>
  
</sect1>
