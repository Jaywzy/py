<!-- doc/src/sgml/ltdts_recvlogical_ora.sgml -->
<sect1 id="ltdts_recvlogical_ora" xreflabel="ltdts_recvlogical_ora">
    <title>ltdts_recvlogical_ora</title>
    <indexterm zone="ltdts_recvlogical_ora">
        <primary>ltdts_recvlogical_ora</primary>
    </indexterm>
    <para>
	The goal of <emphasis>ltdts_recvlogical_ora</emphasis> is to extract data from oracle,transform in target format, and synchronize data to lightdb.
    </para>
	
    <sect2 id="configuration-oracle-xstream">
        <title>Preparation</title>
        <para>You need to finish the preparation work before you run the ltdts_recvlogical_ora server.</para>
        <programlisting>
        # Open Oracle archive log and enable XStream.
        sqlplus /nolog
		CONNECT sys/password@host:port AS SYSDBA;
		
		alter system set db_recovery_file_dest_size = 100G;
		alter system set db_recovery_file_dest = '/opt/oracle/oradata/recovery_area' scope=spfile;
		alter system set enable_goldengate_replication=true;
		shutdown immediate;
		startup mount;
		alter database archivelog;
		alter database open;
		-- select status from v$instance;
		-- Should show "Database log mode: Archive Mode"
		archive log list;
		exit;
		
		# Creating an XStream Administrator user
		sqlplus sys/password@host:port/SID as sysdba
		
		CREATE TABLESPACE xstream_adm_tbs DATAFILE '/opt/oracle/oradata/orcl/xstream_adm_tbs.dbf' SIZE 25M REUSE AUTOEXTEND ON MAXSIZE UNLIMITED;
		CREATE USER xstrmadmin IDENTIFIED BY dbz DEFAULT TABLESPACE xstream_adm_tbs QUOTA UNLIMITED ON xstream_adm_tbs;
		GRANT CREATE SESSION TO xstrmadmin;
		BEGIN
		   DBMS_XSTREAM_AUTH.GRANT_ADMIN_PRIVILEGE(
			  grantee                 => 'xstrmadmin',
			  privilege_type          => 'CAPTURE',
			  grant_select_privileges => TRUE,
			  container             => 'ALL'
		   );
		END;
		
		# Creating the connectorâ€™s XStream user
		
		CREATE TABLESPACE xstream_tbs DATAFILE '/opt/oracle/oradata/orcl/xstream_tbs.dbf' SIZE 25M REUSE AUTOEXTEND ON MAXSIZE UNLIMITED;
		CREATE USER xstrm IDENTIFIED BY dbz DEFAULT TABLESPACE xstream_tbs QUOTA UNLIMITED ON xstream_tbs;
		GRANT CREATE SESSION TO xstrm;
		GRANT SELECT ON V_$DATABASE to xstrm;
		GRANT FLASHBACK ANY TABLE TO xstrm;
		GRANT SELECT ANY TABLE to xstrm;
		GRANT LOCK ANY TABLE TO xstrm;
		grant select_catalog_role to xstrm;
		GRANT EXECUTE_CATALOG_ROLE TO xstrm;

		alter database add supplemental log data (all) columns;
		exit;
		
		
		# Create an XStream Outbound Server
		sqlplus xstrmadmin/password@host:port/SID

		DECLARE
		  tables DBMS_UTILITY.UNCL_ARRAY;
		  schemas DBMS_UTILITY.UNCL_ARRAY;
		BEGIN
		   tables(1) := NULL;
		   schemas(1) := 'XSTRM';
		   DBMS_XSTREAM_ADM.CREATE_OUTBOUND(
			  server_name => 'dbzxout',
			  table_names => tables,
			  schema_names => schemas
		   );
		END;
		/
		exit;
		
		# Configure the XStream user account to connect to the XStream Outbound Server
		sqlplus sys/password@host:port/SID as sysdba
		BEGIN
		   DBMS_XSTREAM_ADM.ALTER_OUTBOUND(
			  server_name  => 'dbzxout',
			  connect_user => 'xstrm'
		   );
		END;
		/
		exit;
        </programlisting>
    </sect2>
    <sect2 id="Configuration_Options">
        <title>Options</title>
        <variablelist>
        <varlistentry>
            <term>
                <varname>--oh</varname>
                <indexterm>
                <primary><varname>--oh</varname>Options</primary>
                </indexterm>
            </term>
            <listitem>
            <para>
                Specifies the host of the Oracle,the port of the Oracle,and the database name of the Oracle.
				The format is like 192.168.1.1:1521/ORCL
            </para>
           </listitem>
        </varlistentry>
		<varlistentry>
            <term>
                <varname>--ou</varname>
                <indexterm>
                <primary><varname>--ou</varname>Options</primary>
                </indexterm>
            </term>
            <listitem>
            <para>
                Oracle user name to connect as
            </para>
           </listitem>
        </varlistentry>
		<varlistentry>
            <term>
                <varname>--op</varname>
                <indexterm>
                <primary><varname>--op</varname>Options</primary>
                </indexterm>
            </term>
            <listitem>
            <para>
                Oracle user password
            </para>
           </listitem>
        </varlistentry>
		<varlistentry>
            <term>
                <varname>--oa</varname>
                <indexterm>
                <primary><varname>--oa</varname>Options</primary>
                </indexterm>
            </term>
            <listitem>
            <para>
                Oracle XStream out apply name
            </para>
           </listitem>
        </varlistentry>
		<varlistentry>
            <term>
                <varname>--m</varname>
                <indexterm>
                <primary><varname>--m</varname>Options</primary>
                </indexterm>
            </term>
            <listitem>
            <para>
                Data synchronization format mode, options are {SQL,JSON},the default value is SQL.
            </para>
           </listitem>
        </varlistentry>
		<varlistentry>
            <term>
                <varname>--m</varname>
                <indexterm>
                <primary><varname>--m</varname>Options</primary>
                </indexterm>
            </term>
            <listitem>
            <para>
                Data synchronization format mode, options are {SQL,JSON},the default value is SQL.
            </para>
           </listitem>
        </varlistentry>
		<varlistentry>
            <term>
                <varname>--sd</varname>
                <indexterm>
                <primary><varname>--sd</varname>Options</primary>
                </indexterm>
            </term>
            <listitem>
            <para>
                Where do you want to synchronize data, options are {LT,FILE},the default value is LT.
				[tips:LT is short for LightDB]
            </para>
           </listitem>
        </varlistentry>
		<varlistentry>
            <term>
                <varname>--lh</varname>
                <indexterm>
                <primary><varname>--lh</varname>Options</primary>
                </indexterm>
            </term>
            <listitem>
            <para>
                Specifies the host of the LightDB,the port of the LightDB,and the database name of the LightDB.
				The format is like 192.168.1.1:5432/postgres
            </para>
           </listitem>
        </varlistentry>
		<varlistentry>
            <term>
                <varname>--lu</varname>
                <indexterm>
                <primary><varname>--lu</varname>Options</primary>
                </indexterm>
            </term>
            <listitem>
            <para>
                LightDB user name to connect as.
            </para>
           </listitem>
        </varlistentry>
		<varlistentry>
            <term>
                <varname>--lp</varname>
                <indexterm>
                <primary><varname>--lp</varname>Options</primary>
                </indexterm>
            </term>
            <listitem>
            <para>
                LightDB user password.
            </para>
           </listitem>
        </varlistentry>
        </variablelist>
    </sect2>
 </sect1>